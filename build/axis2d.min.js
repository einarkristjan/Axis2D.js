/*! Axis2D.js 0.1.0 */
(function(){var a,b,c,d,e,f,g,h,i;h="undefined"!=typeof exports&&null!==exports?exports:null!=this.intersect?this.intersect:this.intersect={},h.epsilon=g=1e-8,h.abs=e=function(a){return 0>a?-a:a},h.clamp=f=function(a,b,c){return b>a?b:a>c?c:a},h.sign=i=function(a){return 0>a?-1:1},h.Point=c=function(){function a(a,b){null==a&&(a=0),null==b&&(b=0),this.x=a,this.y=b}return a.prototype.clone=function(){return new a(this.x,this.y)},a.prototype.normalize=function(){var a,b;return b=this.x*this.x+this.y*this.y,b>0&&(b=Math.sqrt(b),a=1/b,this.x*=a,this.y*=a),b},a}(),h.Hit=b=function(){function a(a){this.collider=a,this.pos=new c,this.delta=new c,this.normal=new c}return a}(),h.Sweep=d=function(){function a(){this.hit=null,this.pos=new c,this.time=1}return a}(),h.AABB=a=function(){function a(a,b){this.pos=a,this.half=b}return a.prototype.intersectPoint=function(a){var c,d,f,g,h,j,k;return c=a.x-this.pos.x,g=this.half.x-e(c),0>=g?null:(d=a.y-this.pos.y,h=this.half.y-e(d),0>=h?null:(f=new b(this),h>g?(j=i(c),f.delta.x=g*j,f.normal.x=j,f.pos.x=this.pos.x+this.half.x*j,f.pos.y=a.y):(k=i(d),f.delta.y=h*k,f.normal.y=k,f.pos.x=a.x,f.pos.y=this.pos.y+this.half.y*k),f))},a.prototype.intersectSegment=function(a,c,d,e){var g,h,j,k,l,m,n,o,p,q,r;return null==d&&(d=0),null==e&&(e=0),o=1/c.x,p=1/c.y,q=i(o),r=i(p),m=(this.pos.x-q*(this.half.x+d)-a.x)*o,n=(this.pos.y-r*(this.half.y+e)-a.y)*p,h=(this.pos.x+q*(this.half.x+d)-a.x)*o,j=(this.pos.y+r*(this.half.y+e)-a.y)*p,m>j||n>h?null:(l=m>n?m:n,g=j>h?h:j,l>=1||0>=g?null:(k=new b(this),k.time=f(l,0,1),m>n?(k.normal.x=-q,k.normal.y=0):(k.normal.x=0,k.normal.y=-r),k.delta.x=k.time*c.x,k.delta.y=k.time*c.y,k.pos.x=a.x+k.delta.x,k.pos.y=a.y+k.delta.y,k))},a.prototype.intersectAABB=function(a){var c,d,f,g,h,j,k;return c=a.pos.x-this.pos.x,g=a.half.x+this.half.x-e(c),0>=g?null:(d=a.pos.y-this.pos.y,h=a.half.y+this.half.y-e(d),0>=h?null:(f=new b(this),h>g?(j=i(c),f.delta.x=g*j,f.normal.x=j,f.pos.x=this.pos.x+this.half.x*j,f.pos.y=a.pos.y):(k=i(d),f.delta.y=h*k,f.normal.y=k,f.pos.x=a.pos.x,f.pos.y=this.pos.y+this.half.y*k),f))},a.prototype.sweepAABB=function(a,b){var c,e;return e=new d,0===b.x&&0===b.y?(e.pos.x=a.pos.x,e.pos.y=a.pos.y,e.hit=this.intersectAABB(a),e.time=null!=e.hit?e.hit.time=0:1):(e.hit=this.intersectSegment(a.pos,b,a.half.x,a.half.y),null!=e.hit?(e.time=f(e.hit.time-g,0,1),e.pos.x=a.pos.x+b.x*e.time,e.pos.y=a.pos.y+b.y*e.time,c=b.clone(),c.normalize(),e.hit.pos.x+=c.x*a.half.x,e.hit.pos.y+=c.y*a.half.y):(e.pos.x=a.pos.x+b.x,e.pos.y=a.pos.y+b.y,e.time=1)),e},a.prototype.sweepInto=function(a,b){var c,e,f,g,h;for(e=new d,e.time=1,e.pos.x=this.pos.x+b.x,e.pos.y=this.pos.y+b.y,g=0,h=a.length;h>g;g++)c=a[g],f=c.sweepAABB(this,b),f.time<e.time&&(e=f);return e},a}()}).call(this),Axis2D={version:"0.1.0"},Axis2D.typeCheck=function(a,b,c){var d=!1,e="",f=a.constructor.toString();if(f=f.match(/function (.*)\(/)[1],"string"==typeof c&&c!==f?d=!0:"function"!=typeof c||a instanceof c||(d=!0),d)throw e+="In last stack call, ",e+='parameter "'+b+'" should be of type: '+c,new TypeError(e)},"object"==typeof module&&(module.exports=Axis2D),Axis2D.World=function(a){a&&Axis2D.typeCheck(a,"cellSize","Number"),this._grid=new Axis2D.Grid(this,a),this._colliders=[],this._collidersHit=[],this._responses={},this._debugDraw=void 0,this._collisionCallback=void 0,this._dynamicColliders=[],this.createResponseType("touch",function(a){var b=a._sweepToDelta();b.hit&&(a._delta.x=0,a._delta.y=0)}),this.createResponseType("slide",function(a){var b=a._sweepToDelta();b.hit&&(b.hit.normal.x?a._delta.x=0:b.hit.normal.y&&(a._delta.y=0),b=a._sweepToDelta(),b.hit&&(a._delta.x=0,a._delta.y=0))}),this.createResponseType("bounce",function(a){var b=a._sweepToDelta();b.hit&&(b.hit.normal.x&&(a._delta.x=-a._delta.x),b.hit.normal.y&&(a._delta.y=-a._delta.y),b=a._sweepToDelta(),b.hit&&(a._delta.x=0,a._delta.y=0))})},Axis2D.World.prototype={update:function(){this._collidersHit.forEach(function(a){a._hits=[],a._lastHitPositions=[],a._isTouching.top=!1,a._isTouching.left=!1,a._isTouching.right=!1,a._isTouching.bottom=!1},this),this._collidersHit=[],this._dynamicColliders.forEach(function(a){var b;a.isSensor()?b=a._sweepToDelta():this._responses[a.getResponseType()].call(this,a),a._AABB.pos.x+=a._delta.x,a._AABB.pos.y+=a._delta.y,this._grid._placeColliderInGrid(a),a._potentialHitColliders=[],a._isDynamic=!1,a._delta.x=0,a._delta.y=0},this),this._dynamicColliders=[],this._collidersHit.forEach(function(a){a._calculateTouches(),a._collisionCallback&&a._collisionCallback(a.getHits(),a.getTouches())},this),this._collisionCallback&&this._collidersHit.length&&this._collisionCallback(this._collidersHit)},createCollider:function(a,b,c,d){return new Axis2D.Collider(this,a,b,c,d)},removeCollider:function(a){Axis2D.typeCheck(a,"collider",Axis2D.Collider);var b=this._colliders.indexOf(a),c=this._dynamicColliders.indexOf(a);this._grid._clearColliderFromGrid(a),-1!==b&&this._colliders.splice(b,1),-1!==c&&this._dynamicColliders.splice(c,1)},createDebugDraw:function(){return new Axis2D.DebugDraw(this)},debugDraw:function(){Axis2D.typeCheck(this._debugDraw,"this._debugDraw",Axis2D.DebugDraw),this._debugDraw._draw()},createResponseType:function(a,b){Axis2D.typeCheck(a,"name","String"),Axis2D.typeCheck(b,"response","Function"),this._responses[a]=b},getCollidersHit:function(){return this._collidersHit},setCollisionCallback:function(a){Axis2D.typeCheck(a,"callback","Function"),this._collisionCallback=a},getColliders:function(){return this._colliders},countColliders:function(){return this._colliders.length},countGridCells:function(){return Object.keys(this._grid._cells).length},setCellSize:function(a){Axis2D.typeCheck(a,"cellSize","Number"),this._grid._cellSize=a,this._colliders.forEach(function(a){this._grid._placeColliderInGrid(a)},this)},queryPoint:function(a,b){Axis2D.typeCheck(a,"x","Number"),Axis2D.typeCheck(a,"y","Number");var c=[],d=Math.floor(a/this._grid._cellSize),e=Math.floor(b/this._grid._cellSize),f="x"+d+"y"+e;return this._grid._cells[f]&&this._grid._cells[f].forEach(function(d){d._AABB.intersectPoint(new intersect.Point(a,b))&&c.push(d)},this),c},queryRect:function(a,b,c,d){Axis2D.typeCheck(a,"centerX","Number"),Axis2D.typeCheck(b,"centerY","Number"),Axis2D.typeCheck(c,"width","Number"),Axis2D.typeCheck(d,"height","Number");var e=[],f=this.createCollider(a,b,c,d);return f.setSensor(!0),f._placeInPotentialGrid(),f._potentialHitColliders.forEach(function(a){f._AABB.intersectAABB(a._AABB)&&e.push(a)},!0),this.removeCollider(f),e},rayCast:function(a,b,c,d,e,f){Axis2D.typeCheck(a,"callback","Function"),Axis2D.typeCheck(b,"x1","Number"),Axis2D.typeCheck(c,"y1","Number"),Axis2D.typeCheck(d,"x2","Number"),Axis2D.typeCheck(e,"y2","Number");var g,h=d,i=e,j=[],k=this.createCollider(b,c,1,1);k._delta.x=d-b,k._delta.y=e-c,f&&(Axis2D.typeCheck(f,"groupFilter","Array"),k.setGroupFilters(f)),g=k._sweepToDelta(),k._hits.length&&(j=k._hits.slice()),g.hit&&(h=g.hit.pos.x,i=g.hit.pos.y),this.removeCollider(k),a(new intersect.Point(h,i),j)}},Axis2D.Grid=function(a,b){Axis2D.typeCheck(a,"axisWorld",Axis2D.World),b&&Axis2D.typeCheck(b,"cellSize","Number"),this._axisWorld=a,this._cellSize=Math.abs(b)||64,this._cells={}},Axis2D.Grid.prototype={_placeColliderInGrid:function(a){this._clearColliderFromGrid(a),this._getColliderKeysInGrid(a).forEach(function(b){this._cells[b]||(this._cells[b]=[]),-1===this._cells[b].indexOf(a)&&(a._positionInGridKeys.push(b),this._cells[b].push(a))},this)},_clearColliderFromGrid:function(a){var b;a._positionInGridKeys.forEach(function(c){b=this._cells[c],b.splice(b.indexOf(a),1),b.length||delete this._cells[c]},this),a._positionInGridKeys=[]},_getColliderKeysInGrid:function(a){for(var b,c,d=0,e=0,f=a._AABB.pos.x-a._AABB.half.x,g=a._AABB.pos.y-a._AABB.half.y,h=2*a._AABB.half.x,i=2*a._AABB.half.y,j=this._cellSize,k=[];b=Math.floor((d+f)/j),c=Math.floor((e+g)/j),k.push("x"+b+"y"+c),d!==h||e!==i;)d===h?(d=0,e+=j,e>i&&(e=i)):d+=j,d>h&&(d=h);return k}},Axis2D.Collider=function(a,b,c,d,e){Axis2D.typeCheck(a,"axisWorld",Axis2D.World),Axis2D.typeCheck(b,"centerX","Number"),Axis2D.typeCheck(c,"centerY","Number"),Axis2D.typeCheck(d,"width","Number"),Axis2D.typeCheck(e,"height","Number"),this._axisWorld=a,this._AABB=new intersect.AABB({},{}),this._AABB.pos.x=b||0,this._AABB.pos.y=c||0,this._AABB.half.x=(Math.abs(d)||a._grid._cellSize-1)/2,this._AABB.half.y=(Math.abs(e)||a._grid._cellSize-1)/2,this._delta=new intersect.Point(0,0),this._responseType="slide",this._isTouching={top:!1,left:!1,right:!1,bottom:!1},this._potentialHitColliders=[],this._isSensor=!1,this._groupName="",this._groupFilters=[],this._positionInGridKeys=[],this._hits=[],this.userData=void 0,this._collisionCallback=void 0,this._isDynamic=!1,this._axisWorld._grid._placeColliderInGrid(this),this._axisWorld._colliders.push(this)},Axis2D.Collider.prototype={moveTo:function(a,b){this._delta.x=a-this._AABB.pos.x,this._delta.y=b-this._AABB.pos.y,(this._delta.x||this._delta.y)&&this.setAsDynamic()},resize:function(a,b){var c=a/2,d=b/2;this._AABB.half.x!==c&&this._AABB.half.y!==d&&(this._AABB.half.x=a/2,this._AABB.half.y=b/2,this.setAsDynamic())},setGroupName:function(a){Axis2D.typeCheck(a,"name","String"),this._groupName=a},setGroupFilters:function(a){Axis2D.typeCheck(a,"names","Array"),this._groupFilters=a},setResponseType:function(a){if(Axis2D.typeCheck(a,"type","String"),-1===Object.keys(this._axisWorld._responses).indexOf(a))throw Error("response type does not exist in Axis2D World");this._responseType=a},getResponseType:function(){return this._responseType},setCollisionCallback:function(a){Axis2D.typeCheck(a,"callback","Function"),this._collisionCallback=a},getPosition:function(){return this._AABB.pos},getWidth:function(){return 2*this._AABB.half.x},getHeight:function(){return 2*this._AABB.half.y},getHits:function(){return this._hits},getTouches:function(){return this._isTouching},setSensor:function(a){Axis2D.typeCheck(a,"bool","Boolean"),this._isSensor=a},isSensor:function(){return this._isSensor},setAsDynamic:function(){this._isDynamic||(this._isDynamic=!0,this._axisWorld._dynamicColliders.push(this))},_placeInPotentialGrid:function(){var a=this._AABB.half.x,b=this._AABB.half.y,c=this._AABB.pos.x,d=this._AABB.pos.y;this._AABB.pos.x+=this._delta.x/2,this._AABB.pos.y+=this._delta.y/2,this._AABB.half.x=Math.abs(this._delta.x)/2+a,this._AABB.half.y=Math.abs(this._delta.y)/2+b,this._axisWorld._grid._placeColliderInGrid(this),this._positionInGridKeys.forEach(function(a){this._axisWorld._grid._cells[a].forEach(function(a){this!==a&&-1===this._potentialHitColliders.indexOf(a)&&this._potentialHitColliders.push(a)},this)},this),this._AABB.pos.x=c,this._AABB.pos.y=d,this._AABB.half.x=a,this._AABB.half.y=b},_calculateTouches:function(){this.isSensor()||this._hits.forEach(function(a){var b=a.collider,c=this._groupFilters,d=-1===c.indexOf(b._groupName);!b.isSensor()&&d&&(a.normal.x>0?this._isTouching.left=!0:a.normal.x<0&&(this._isTouching.right=!0),a.normal.y>0?this._isTouching.top=!0:a.normal.y<0&&(this._isTouching.bottom=!0))},this)},_addHit:function(a){for(var b=0;b<this._hits.length;b++)if(a.collider===this._hits[b].collider)return;this._hits.push(a)},_sweepToDelta:function(){var a=this._AABB,b=this._delta,c=new intersect.Sweep,d=this._potentialHitColliders;return c.time=1,c.pos.x=a.pos.x+b.x,c.pos.y=a.pos.y+b.y,this._placeInPotentialGrid(),d.forEach(function(d){var e=d._AABB.sweepAABB(a,b),f=this._groupFilters,g=d._groupFilters,h=-1!==g.indexOf(this._groupName),i=-1!==f.indexOf(d._groupName);e.hit&&(e.hit.delta.x+=.99*e.hit.normal.x,e.hit.delta.y+=.99*e.hit.normal.y,this.isSensor()||h?(this._addHits(e.hit,[d]),this._AABB.pos.x-=e.hit.delta.x,this._AABB.pos.y-=e.hit.delta.y):e.time<c.time&&(d.isSensor()||i?(this._addHits(e.hit,[d]),this._AABB.pos.x-=e.hit.delta.x,this._AABB.pos.y-=e.hit.delta.y):(e.hit.collider=d,c=e)))},this),c.hit&&this._addHits(c.hit,d),c},_addHits:function(a,b){this._AABB.pos.x+=a.delta.x-a.normal.x,this._AABB.pos.y+=a.delta.y-a.normal.y,b.forEach(function(b){var c,d=this._AABB.intersectAABB(b._AABB);d&&(c=b._AABB.intersectAABB(this._AABB),c.delta=a.delta,c.collider=b,d.collider=this,d.delta.x=0,d.delta.y=0,this._addHit(c),b._addHit(d),-1===this._axisWorld._collidersHit.indexOf(this)&&this._axisWorld._collidersHit.push(this),-1===this._axisWorld._collidersHit.indexOf(b)&&this._axisWorld._collidersHit.push(b))},this),this._AABB.pos.x+=a.normal.x,this._AABB.pos.y+=a.normal.y}},Axis2D.DebugDraw=function(a){Axis2D.typeCheck(a,"axisWorld",Axis2D.World),this._axisWorld=a,this._colliderCallback=void 0,this._gridCallback=void 0,this._axisWorld._debugDraw=this},Axis2D.DebugDraw.prototype={setColliderCallback:function(a){Axis2D.typeCheck(a,"callback","Function"),this._colliderCallback=a},setGridCallback:function(a){Axis2D.typeCheck(a,"callback","Function"),this._gridCallback=a},_draw:function(){this._colliderCallback&&this._getColliders(this._colliderCallback),this._gridCallback&&this._getGrid(this._gridCallback)},_getColliders:function(a){var b,c,d,e,f,g,h=this._axisWorld;h._colliders.forEach(function(h){b=h._AABB.pos.x-h._AABB.half.x,c=h._AABB.pos.y-h._AABB.half.y,d=b+h._AABB.half.x,e=c+h._AABB.half.y,f=2*h._AABB.half.x,g=2*h._AABB.half.y,a(b,c,f,g,h.isSensor())},this)},_getGrid:function(a){var b,c,d,e,f,g=this._axisWorld,h=g._grid._cellSize;for(c in g._grid._cells)b=g._grid._cells[c],f=c.split(/(\-?\d*)/),d=f[1]*h,e=f[3]*h,a(d,e,h,h,b.length)}};